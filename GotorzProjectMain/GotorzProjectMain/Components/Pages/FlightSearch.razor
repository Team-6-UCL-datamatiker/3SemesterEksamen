@page "/flights/search"

@using AutoMapper
@using GotorzProjectMain.Components.Pages.HotelPages
@using GotorzProjectMain.Models

@inject IMapper Mapper
@inject ILogger<FlightSearch> Logger

@rendermode InteractiveServer
<details>
    <summary class="summary-heading">Flight Search 1</summary><br/>
    <FlightComponent ComponentId="1" OnFlightSelected="HandleFlightSelected" />
</details>
<details>
    <summary class="summary-heading">Flight Search 2</summary><br/>
    <FlightComponent ComponentId="2" OnFlightSelected="HandleFlightSelected" />
</details>
<details>
    <summary class="summary-heading">Hotel Search</summary><br />
    <SearchHotels OnHotelSelected="HandleHotelSelected" />
</details>

@code
{
    FlightRoute? Outward { get; set; }
    FlightRoute? Return { get; set; }
    HotelBooking? HotelBooking { get; set; }

    private void HandleFlightSelected((string ComponentId, FlightRoute Route) selection)
    {
        if (selection.ComponentId == "1")
        {
            Outward = selection.Route;
        }
        else if (selection.ComponentId == "2")
        {
            Return = selection.Route;
        }
    }

    private void HandleHotelSelected(Hotel selectedHotel)
    {
        try
        {
            HotelBooking = Mapper.Map<HotelBooking>(selectedHotel);
        }
        catch (Exception ex)
        {
            Logger.LogError($"Mapping error: {ex}");
        }
    }
}


