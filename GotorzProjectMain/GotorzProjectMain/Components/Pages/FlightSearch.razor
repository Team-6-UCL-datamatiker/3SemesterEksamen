@page "/flights/search"

@using GotorzProjectMain.Models
@using GotorzProjectMain.Services.API

@inject IFlightService FlightService

@rendermode InteractiveServer

<input @bind="From" placeholder="Origin IATA" />
<input @bind="To" placeholder="Destination IATA" />
<input type="date" @bind="Outbound" />
<input @bind="AdultCount" type="number" min="1" />
<input @bind="ChildCount" type="number" min="0" />

<label>
	<input type="checkbox" @bind="DeepSearch" />
	Exact match
</label>

<button @onclick="Search">Search</button>
<button @onclick="DebugFetch">Search</button>

@if (Flights != null)
{
	<table>
		<thead>
			<tr>
				<th>Route</th>
				<th>Depart</th>
				<th>Arrive</th>
				<th>Price</th>
				<th>Airline</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var o in Flights)
			{
				<tr>
					<td>@o.DepartureAirportCode → @o.ArrivalAirportCode</td>
					<td>@o.DepartureTime</td>
					<td>@o.ArrivalTime</td>
					<td>@o.Price DKK</td>
					<td>@o.Airline</td>
				</tr>
			}
		</tbody>
	</table>

	<pre style="white-space:pre-wrap">@RawJson</pre>

}

@code {
	string From = "CPH", To = "LHR";
	DateTime Outbound = DateTime.Today.AddDays(7);
	int AdultCount = 1;
	int ChildCount = 0;
	bool DeepSearch = false;
	List<Flight>? Flights;

	async Task Search() =>
			Flights = await FlightService
		.SearchAsync(From, To, Outbound, AdultCount, ChildCount, DeepSearch);

	string RawJson = "";

	async Task DebugFetch()
	{
		RawJson = await FlightService.GetRawJsonAsync(From, To, Outbound, DeepSearch);
	}
}
